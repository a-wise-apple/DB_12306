import { computed } from 'vue'
import { useUiStore } from '../store/ui'

type LocaleKey = keyof typeof messages['zh']

const messages = {
  zh: {
    appName: '智能铁路助手',
    nav: {
      home: '首页',
      schedules: '查询车次',
      orders: '我的订单',
      trading: '余票交易',
      admin: '管理员',
      login: '登录',
      register: '注册',
      logout: '退出登录'
    },
    toolbar: {
      theme: '主题',
      language: '语言',
      dark: '深色',
      light: '浅色',
      zh: '中文',
      en: '英文'
    },
    home: {
      heroBadge: '智能铁路出行助手',
      heroTitle: '一站式完成火车票查询、预订与订单管理',
      heroSubtitle: '通过清晰的操作入口快速完成行程安排，随时掌握订单状态，并在需要时进入余票交易平台或管理员后台。',
      searchNow: '立即查询车次',
      viewOrders: '查看我的订单',
      quickLogin: '快速登录',
      currentLogin: '当前登录',
      tipTitle: '小提示',
      tipContent: '登录后可快速查看订单、参与余票交易或进入管理员后台。',
      quickEntry: '快捷入口',
      tradingTitle: '余票交易平台',
      tradingDesc: '查看并挂出车票，灵活调整行程。',
      orderCenter: '订单中心',
      orderDesc: '管理已购票、退款与改签请求。',
      adminConsole: '管理员后台',
      adminDesc: '管理员登录后可访问更多功能。',
      toolsBadge: '便捷工具',
      toolsTitle: '将复杂流程化繁为简',
      toolsDesc: '精选常用操作与贴心提醒，让订票体验更加顺畅。',
      searchTitle: '精准车次搜索',
      searchDesc: '按日期、车次或车站快速筛选，支持一键跳转预订。',
      manageTitle: '安心订单管理',
      manageDesc: '集中查看所有订单，及时处理退改签并接收状态反馈。',
      tradeTitle: '余票交易协作',
      tradeDesc: '在官方渠道安全转让余票，让每一张车票发挥最大价值。',
      guideBadge: '贴心指引',
      guideTitle: '三步完成行程安排',
      guideDesc: '从搜索到预订再到管理，每一步都保持透明与简洁。',
      demoBooking: '体验示例预订',
      step1Title: '搜索最优车次',
      step1Desc: '输入出发到达信息，智能排序与筛选满足不同需求。',
      step2Title: '完成在线预订',
      step2Desc: '选择座席与乘车人信息，实时确认余票后安全支付。',
      step3Title: '随时管理订单',
      step3Desc: '在订单中心查看详情，必要时发起退改签或票务交易。',
      loggedOut: '已退出登录'
    },
    booking: {
      title: '选择座位',
      back: '返回',
      loading: '座位加载中...',
      passengerInfo: '乘车人信息',
      seatLabel: '座位',
      passengerName: '乘客姓名',
      confirm: '确认预订',
      invalidSchedule: '无效的车次信息',
      loadError: '座位加载失败',
      nameWarning: '请填写所有乘客姓名',
      loginWarning: '请先登录',
      success: '预订成功！',
      failed: '预订失败',
      statusLocked: '已锁定',
      statusReserved: '已预订',
      statusSold: '已售出',
      statusAvailable: '可选',
      selectHint: '单击可选择座位，再次点击可取消。',
      coachTitle: '车厢 {coach}（{type}）',
      seatDisplay: '车厢 {coach} - 座位 {seat}',
      unknownCoachType: '未知车型'
    },
    schedule: {
      title: '车次查询',
      date: '出发日期',
      pickDate: '请选择日期',
      trainNo: '车次号',
      trainPlaceholder: '可选填写车次号',
      search: '搜索',
      trainLabel: '车次',
      type: '车型',
      departDate: '出发日期',
      status: '状态',
      actions: '操作',
      stops: '停靠站',
      book: '预订',
      stopSeq: '序号',
      station: '车站',
      arrival: '到达',
      departure: '出发',
      dateWarning: '请选择查询日期'
    },
    login: {
      title: '登录',
      username: '用户名/证件号',
      password: '密码',
      submit: '登录',
      goRegister: '没有账号？去注册',
      missing: '请填写用户名和密码',
      success: '登录成功',
      failed: '账号或密码错误'
    },
    register: {
      title: '注册新用户',
      subtitle: '填写实名信息后即可登录并预订车票',
      name: '姓名',
      idNumber: '证件号',
      phone: '手机号',
      email: '邮箱（可选）',
      password: '密码',
      submit: '提交注册',
      backToLogin: '已有账号？前往登录',
      missing: '请完整填写必填信息',
      success: '注册成功，已自动登录',
      conflict: '证件号或手机号已被注册',
      failed: '注册失败，请稍后重试'
    },
    orders: {
      title: '我的订单',
      orderId: '订单编号',
      status: '状态',
      amount: '金额',
      created: '创建时间',
      actions: '操作',
      cancel: '取消',
      sell: '转售',
      cancelConfirm: '确定要取消该订单吗？',
      warn: '提示',
      yes: '确定',
      no: '返回',
      cancelled: '已取消订单',
      cancelFailed: '取消订单失败',
      sellPrompt: '请输入转售价格',
      sellTitle: '发布转售',
      sellAction: '确认发布',
      sellCancel: '取消',
      priceError: '价格格式不正确',
      sellSuccess: '转售发布成功',
      sellFailed: '转售失败'
    },
    trading: {
      title: '余票交易平台',
      train: '车次',
      departure: '发车时间',
      seat: '座位',
      seller: '卖家',
      price: '价格',
      actions: '操作',
      buy: '购买',
      cancel: '撤销',
      loadFailed: '加载列表失败',
      needLogin: '请先登录',
      confirmBuy: '确认以 ¥{price} 购买该车票？',
      confirmTitle: '确认购买',
      buyAction: '确认',
      buyCancel: '取消',
      buySuccess: '购票成功',
      buyFailed: '购票失败',
      removeConfirm: '确定要下架该转售吗？',
      removeTitle: '确认下架',
      removeYes: '是',
      removeNo: '否',
      removeSuccess: '已下架',
      removeFailed: '下架失败'
    },
    admin: {
      title: '管理员后台',
      scheduleTab: '车次管理',
      checkinTab: '验票',
      tradingTab: '交易审核',
      train: '列车',
      selectTrain: '选择列车',
      date: '出发日期',
      pickDate: '请选择日期',
      stops: '停靠站',
      station: '车站',
      arrival: '到达时间',
      departure: '出发时间',
      sequence: '序号',
      remove: '删除',
      addStop: '新增停靠',
      coaches: '车厢',
      coachNo: '车厢号',
      coachType: '席别',
      firstClass: '一等座',
      secondClass: '二等座',
      seats: '座位数',
      addCoach: '新增车厢',
      createSchedule: '创建车次',
      scheduleSuccess: '创建成功',
      scheduleFailed: '创建失败',
      ticketId: '车票编号',
      employeeId: '员工号',
      checkin: '验票',
      checkinSuccess: '验票成功',
      checkinFailed: '验票失败',
      listingId: '编号',
      seller: '卖家',
      price: '价格',
      status: '状态',
      actions: '操作',
      delete: '删除',
      deleteConfirm: '确定删除该转售吗？',
      deleteSuccess: '删除成功',
      deleteFailed: '删除失败',
      refresh: '刷新',
      loadFailed: '加载失败'
    }
  },
  en: {
    appName: 'Smart Railway Assistant',
    nav: {
      home: 'Home',
      schedules: 'Schedules',
      orders: 'Orders',
      trading: 'Trading',
      admin: 'Admin',
      login: 'Login',
      register: 'Register',
      logout: 'Logout'
    },
    toolbar: {
      theme: 'Theme',
      language: 'Language',
      dark: 'Dark',
      light: 'Light',
      zh: 'Chinese',
      en: 'English'
    },
    home: {
      heroBadge: 'Rail Travel Assistant',
      heroTitle: 'Search, book, and manage train tickets in one place',
      heroSubtitle: 'Use the clear entry points to plan trips, track orders, access the resale hub, or open the admin console when needed.',
      searchNow: 'Search Schedules',
      viewOrders: 'My Orders',
      quickLogin: 'Quick Login',
      currentLogin: 'Logged in',
      tipTitle: 'Tip',
      tipContent: 'Sign in to manage orders, join the resale marketplace, or open the admin console.',
      quickEntry: 'Quick Access',
      tradingTitle: 'Ticket Trading',
      tradingDesc: 'List or pick tickets to adjust travel flexibly.',
      orderCenter: 'Order Center',
      orderDesc: 'Manage purchases, refunds, and change requests.',
      adminConsole: 'Admin Console',
      adminDesc: 'Admins can access more tools after login.',
      toolsBadge: 'Handy tools',
      toolsTitle: 'Simplify complex workflows',
      toolsDesc: 'Curated actions and reminders keep booking smooth.',
      searchTitle: 'Precise search',
      searchDesc: 'Filter by date, train, or stations and jump to booking.',
      manageTitle: 'Confident order control',
      manageDesc: 'View all orders, handle changes, and get feedback.',
      tradeTitle: 'Resale collaboration',
      tradeDesc: 'Transfer tickets safely so every seat is used well.',
      guideBadge: 'Guided steps',
      guideTitle: 'Plan a trip in three steps',
      guideDesc: 'From search to booking to management, stay clear and simple.',
      demoBooking: 'Try sample booking',
      step1Title: 'Search the best train',
      step1Desc: 'Enter route info and use smart sorting and filters.',
      step2Title: 'Finish online booking',
      step2Desc: 'Pick seats and passengers, confirm availability, then pay.',
      step3Title: 'Manage anytime',
      step3Desc: 'See details and request changes or resale when needed.',
      loggedOut: 'Logged out'
    },
    booking: {
      title: 'Select Seats',
      back: 'Back',
      loading: 'Loading seats...',
      passengerInfo: 'Passenger Information',
      seatLabel: 'Seat',
      passengerName: 'Passenger Name',
      confirm: 'Confirm Booking',
      invalidSchedule: 'Invalid schedule',
      loadError: 'Failed to load seats',
      nameWarning: 'Please enter all passenger names',
      loginWarning: 'Please login first',
      success: 'Booking confirmed!',
      failed: 'Booking failed',
      statusLocked: 'Locked',
      statusReserved: 'Reserved',
      statusSold: 'Sold',
      statusAvailable: 'Available',
      selectHint: 'Click to select a seat; click again to unselect.',
      coachTitle: 'Coach {coach} ({type})',
      seatDisplay: 'Coach {coach} - Seat {seat}',
      unknownCoachType: 'Unknown type'
    },
    schedule: {
      title: 'Schedule Search',
      date: 'Date',
      pickDate: 'Pick a date',
      trainNo: 'Train No',
      trainPlaceholder: 'Optional train number',
      search: 'Search',
      trainLabel: 'Train No',
      type: 'Type',
      departDate: 'Depart Date',
      status: 'Status',
      actions: 'Actions',
      stops: 'Stops',
      book: 'Book',
      stopSeq: 'Seq',
      station: 'Station',
      arrival: 'Arrival',
      departure: 'Departure',
      dateWarning: 'Please select a date'
    },
    login: {
      title: 'Login',
      username: 'Username / ID',
      password: 'Password',
      submit: 'Login',
      goRegister: 'New here? Create an account',
      missing: 'Please enter username and password',
      success: 'Login successful',
      failed: 'Invalid credentials'
    },
    register: {
      title: 'Create Account',
      subtitle: 'Provide your ID details to start booking quickly.',
      name: 'Full Name',
      idNumber: 'ID Number',
      phone: 'Phone',
      email: 'Email (optional)',
      password: 'Password',
      submit: 'Register Now',
      backToLogin: 'Already have an account? Login',
      missing: 'Please fill in all required fields',
      success: 'Registration successful, you are now signed in',
      conflict: 'ID number or phone is already registered',
      failed: 'Registration failed, please try again later'
    },
    orders: {
      title: 'My Orders',
      orderId: 'Order ID',
      status: 'Status',
      amount: 'Amount',
      created: 'Created At',
      actions: 'Actions',
      cancel: 'Cancel',
      sell: 'Sell',
      cancelConfirm: 'Cancel this order?',
      warn: 'Warning',
      yes: 'Yes',
      no: 'No',
      cancelled: 'Order cancelled',
      cancelFailed: 'Failed to cancel order',
      sellPrompt: 'Enter selling price',
      sellTitle: 'Sell Ticket',
      sellAction: 'List',
      sellCancel: 'Cancel',
      priceError: 'Invalid price',
      sellSuccess: 'Ticket listed',
      sellFailed: 'Failed to list ticket'
    },
    trading: {
      title: 'Ticket Trading Platform',
      train: 'Train',
      departure: 'Departure Time',
      seat: 'Seat',
      seller: 'Seller',
      price: 'Price',
      actions: 'Actions',
      buy: 'Buy',
      cancel: 'Cancel',
      loadFailed: 'Failed to load listings',
      needLogin: 'Please login first',
      confirmBuy: 'Buy this ticket for ¥{price}?',
      confirmTitle: 'Confirm Purchase',
      buyAction: 'Buy',
      buyCancel: 'Cancel',
      buySuccess: 'Ticket purchased successfully!',
      buyFailed: 'Failed to buy ticket',
      removeConfirm: 'Remove this listing?',
      removeTitle: 'Confirm Cancellation',
      removeYes: 'Yes',
      removeNo: 'No',
      removeSuccess: 'Listing removed',
      removeFailed: 'Failed to remove listing'
    },
    admin: {
      title: 'Admin Dashboard',
      scheduleTab: 'Schedule Management',
      checkinTab: 'Check-in',
      tradingTab: 'Trading Moderation',
      train: 'Train',
      selectTrain: 'Select Train',
      date: 'Date',
      pickDate: 'Pick a date',
      stops: 'Stops',
      station: 'Station',
      arrival: 'Arrival',
      departure: 'Departure',
      sequence: 'Seq',
      remove: 'Remove',
      addStop: 'Add Stop',
      coaches: 'Coaches',
      coachNo: 'Coach No',
      coachType: 'Coach Type',
      firstClass: 'First Class',
      secondClass: 'Second Class',
      seats: 'Seats',
      addCoach: 'Add Coach',
      createSchedule: 'Create Schedule',
      scheduleSuccess: 'Schedule created successfully',
      scheduleFailed: 'Failed to create schedule',
      ticketId: 'Ticket ID',
      employeeId: 'Employee ID',
      checkin: 'Check-in',
      checkinSuccess: 'Check-in successful',
      checkinFailed: 'Check-in failed',
      listingId: 'ID',
      seller: 'Seller',
      price: 'Price',
      status: 'Status',
      actions: 'Actions',
      delete: 'Delete',
      deleteConfirm: 'Delete this listing?',
      deleteSuccess: 'Listing deleted',
      deleteFailed: 'Failed to delete listing',
      refresh: 'Refresh',
      loadFailed: 'Failed to load data'
    }
  }
}

const getValue = (obj: any, path: string) => {
  return path.split('.').reduce((acc, key) => (acc && acc[key] !== undefined ? acc[key] : undefined), obj)
}

export const useI18n = () => {
  const uiStore = useUiStore()
  const locale = computed(() => messages[uiStore.language])

  const t = (path: string, params?: Record<string, any>): string => {
    const value = getValue(locale.value, path) ?? path
    if (typeof value === 'string' && params) {
      return value.replace(/\{(\w+)\}/g, (_, k) => params[k] ?? '')
    }
    return value as string
  }

  return { t, locale }
}

export type Language = keyof typeof messages
export type LocaleMessages = typeof messages[Language]
export type LocaleText = LocaleMessages[LocaleKey]
